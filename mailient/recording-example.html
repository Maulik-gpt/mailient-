<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recording Interface Example</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .recording-container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .recording-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }

        .control-btn {
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 8px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .control-btn:not(:disabled):hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .pause-btn {
            background-color: #ffc107;
            color: #212529;
        }

        .pause-btn.recording {
            background-color: #fd7e14;
            color: white;
        }

        .pause-btn.paused {
            background-color: #28a745;
            color: white;
        }

        .stop-btn {
            background-color: #dc3545;
            color: white;
        }

        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 500;
        }

        .status.stopped {
            background-color: #e9ecef;
            color: #6c757d;
        }

        .status.recording {
            background-color: #d4edda;
            color: #155724;
        }

        .status.paused {
            background-color: #fff3cd;
            color: #856404;
        }

        .recording-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .recording-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #dc3545;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .instructions {
            text-align: left;
            margin: 30px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }

        .instructions h3 {
            margin-top: 0;
            color: #007bff;
        }

        .instructions ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .instructions li {
            margin: 8px 0;
        }
    </style>
</head>
<body>
    <div class="recording-container">
        <h1>Recording Interface</h1>

        <div class="recording-indicator" id="recording-indicator" style="display: none;">
            <div class="recording-dot"></div>
            <span id="status-text">Recording...</span>
        </div>

        <div class="recording-controls">
            <button id="pause-btn" class="control-btn pause-btn" disabled title="Start Recording">
                ||
            </button>
            <button id="stop-btn" class="control-btn stop-btn" disabled title="No Active Recording">
                ■
            </button>
        </div>

        <div id="status" class="status stopped">
            Ready to record
        </div>

        <div class="instructions">
            <h3>How to use:</h3>
            <ul>
                <li><strong>Click the pause button (||)</strong> to start recording</li>
                <li><strong>Click the pause button again</strong> to pause/resume recording</li>
                <li><strong>Click the stop button (■)</strong> to end the recording session</li>
                <li>The interface will show visual feedback for the current recording state</li>
            </ul>
        </div>

        <div id="output" style="margin-top: 30px; text-align: left;">
            <h3>Console Output:</h3>
            <pre id="console-output" style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-size: 12px; max-height: 200px; overflow-y: auto;"></pre>
        </div>
    </div>

    <script type="module">
        // Import the recording manager (adjust path as needed)
        import { RecordingManager, RecordingInterface } from './lib/recording-manager.js';

        // Initialize recording manager
        const recordingManager = new RecordingManager();

        // Initialize recording interface
        const recordingInterface = new RecordingInterface(recordingManager);

        // Set up UI elements
        const pauseBtn = document.getElementById('pause-btn');
        const stopBtn = document.getElementById('stop-btn');
        const statusDiv = document.getElementById('status');
        const statusText = document.getElementById('status-text');
        const recordingIndicator = document.getElementById('recording-indicator');
        const consoleOutput = document.getElementById('console-output');

        // Initialize the interface
        if (!recordingInterface.initialize('pause-btn', 'stop-btn')) {
            console.error('Failed to initialize recording interface');
            return;
        }

        // Set up callbacks for demonstration
        recordingManager.setStateChangeCallback((state) => {
            updateUI(state);
            logToConsole(`Recording state changed to: ${state}`);
        });

        recordingManager.setDataAvailableCallback((data) => {
            logToConsole(`Recording data chunk received: ${data.size} bytes`);
        });

        recordingManager.setRecordingCompleteCallback((blob, chunks) => {
            logToConsole(`Recording completed! Blob size: ${blob.size} bytes, Chunks: ${chunks.length}`);

            // Create download link for the recording
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `recording-${new Date().toISOString()}.webm`;
            a.textContent = 'Download Recording';
            a.style.cssText = 'display: inline-block; margin: 10px 0; padding: 10px 20px; background: #007bff; color: white; text-decoration: none; border-radius: 5px;';

            const outputDiv = document.getElementById('output');
            outputDiv.appendChild(a);
        });

        recordingManager.setErrorCallback((error) => {
            logToConsole(`Recording error: ${error.message}`);
            updateUI('stopped');
        });

        // UI update function
        function updateUI(state) {
            // Update status display
            statusDiv.className = `status ${state}`;
            recordingIndicator.style.display = state === 'active' ? 'flex' : 'none';

            switch (state) {
                case 'active':
                    statusDiv.textContent = 'Recording in progress...';
                    statusText.textContent = 'Recording...';
                    pauseBtn.className = 'control-btn pause-btn recording';
                    break;
                case 'paused':
                    statusDiv.textContent = 'Recording paused';
                    statusText.textContent = 'Paused';
                    pauseBtn.className = 'control-btn pause-btn paused';
                    break;
                case 'stopped':
                    statusDiv.textContent = 'Ready to record';
                    statusText.textContent = 'Stopped';
                    pauseBtn.className = 'control-btn pause-btn';
                    break;
            }
        }

        // Console logging function
        function logToConsole(message) {
            const timestamp = new Date().toLocaleTimeString();
            consoleOutput.textContent += `[${timestamp}] ${message}\n`;

            // Auto-scroll to bottom
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        // Check for MediaRecorder support
        if (!RecordingManager.isRecordingSupported()) {
            logToConsole('ERROR: MediaRecorder is not supported in this browser');
            statusDiv.textContent = 'Recording is not supported in this browser';
            statusDiv.className = 'status stopped';
        } else {
            logToConsole('MediaRecorder is supported');
            const supportedTypes = RecordingManager.getSupportedMimeTypes();
            logToConsole(`Supported MIME types: ${supportedTypes.join(', ')}`);
        }

        // Add some initial logging
        logToConsole('Recording interface initialized');
        logToConsole('Click the pause button to start recording');
    </script>
</body>
</html>